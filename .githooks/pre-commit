#!/bin/bash
# Pre-commit hook to run linting and unit tests
# Skip with: git commit --no-verify

set -e

echo "Running ShellCheck on shell scripts..."
find . -name '*.sh' -type f -not -path './.git/*' | xargs shellcheck --severity=warning 2>/dev/null || {
    echo "⚠ ShellCheck not installed, skipping shell lint"
}

echo "Running Hadolint on Dockerfiles..."
find . -name 'Dockerfile' -type f -not -path './.git/*' | while read -r f; do
    hadolint "$f" 2>/dev/null || echo "⚠ Hadolint not installed, skipping Dockerfile lint"
    break
done

echo "Running unit tests..."
uv run pytest tests/test_cli.py -m "not integration" --tb=short -q

echo "✓ All checks passed"
